"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2540],{9944:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var i=t(4848),r=t(8453);const s={sidebar_position:5},d="Data Sharing & Events",a={id:"concepts/data_sharing_and_events",title:"Data Sharing & Events",description:"Ribir provides mechanisms to share data across the widget tree and handle communication between widgets efficiently.",source:"@site/docs/concepts/data_sharing_and_events.md",sourceDirName:"concepts",slug:"/concepts/data_sharing_and_events",permalink:"/docs/next/concepts/data_sharing_and_events",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"RChangelog[bot]",lastUpdatedAt:1772087058e3,sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"State Management",permalink:"/docs/next/concepts/state_management"},next:{title:"Layout System",permalink:"/docs/next/concepts/layout"}},o={},l=[{value:"Provider (Data Down)",id:"provider-data-down",level:2},{value:"Providing Data",id:"providing-data",level:3},{value:"Using <code>providers</code> Field (Recommended)",id:"using-providers-field-recommended",level:4},{value:"Using <code>Providers</code> Widget",id:"using-providers-widget",level:4},{value:"Consuming Data",id:"consuming-data",level:3},{value:"Types of Providers",id:"types-of-providers",level:3},{value:"Variant (Flexible Data Consumption)",id:"variant-flexible-data-consumption",level:2},{value:"Difference from Direct Provider Access",id:"difference-from-direct-provider-access",level:3},{value:"Advantages of Using Variant",id:"advantages-of-using-variant",level:3},{value:"Basic Usage",id:"basic-usage",level:3},{value:"Using Fallbacks",id:"using-fallbacks",level:3},{value:"Mapping Values",id:"mapping-values",level:3},{value:"Special Color Helpers",id:"special-color-helpers",level:3},{value:"Custom Events (Messages Up)",id:"custom-events-messages-up",level:2},{value:"Defining an Event",id:"defining-an-event",level:3},{value:"Dispatching an Event",id:"dispatching-an-event",level:3},{value:"Listening to Events",id:"listening-to-events",level:3},{value:"Listening to Any Custom Event",id:"listening-to-any-custom-event",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"data-sharing--events",children:"Data Sharing & Events"}),"\n",(0,i.jsx)(n.p,{children:"Ribir provides mechanisms to share data across the widget tree and handle communication between widgets efficiently."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Provider"}),": Pass data down the tree (Parent -> Child / Descendants)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Custom Event"}),": Pass messages up the tree (Child -> Parent / Ancestors)."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"provider-data-down",children:"Provider (Data Down)"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Provider"})," system allows you to share data with all descendant widgets without passing props through every level of the hierarchy."]}),"\n",(0,i.jsx)(n.h3,{id:"providing-data",children:"Providing Data"}),"\n",(0,i.jsxs)(n.p,{children:["You can provide data using the ",(0,i.jsx)(n.code,{children:"Providers"})," widget or the ",(0,i.jsx)(n.code,{children:"providers!"})," macro (or ",(0,i.jsx)(n.code,{children:"providers"})," property)."]}),"\n",(0,i.jsxs)(n.h4,{id:"using-providers-field-recommended",children:["Using ",(0,i.jsx)(n.code,{children:"providers"})," Field (Recommended)"]}),"\n",(0,i.jsxs)(n.p,{children:["Most widgets in Ribir (via ",(0,i.jsx)(n.code,{children:"FatObj"}),") support a ",(0,i.jsx)(n.code,{children:"providers"})," field directly (see ",(0,i.jsx)(n.a,{href:"/docs/next/concepts/built_in_attributes_and_fat_obj",children:"Built-in Attributes & FatObj"}),"). This is often cleaner than wrapping your widget in a ",(0,i.jsx)(n.code,{children:"Providers"})," widget."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:"ignore",children:'use ribir::prelude::*;\n\nstruct Theme {\n    primary: Color,\n}\n\nfn app() -> Widget<\'static> {\n    fn_widget! {\n        let theme = Stateful::new(Theme { primary: Color::RED });\n\n        @Column {\n            // Provide data directly on the widget\n            providers: [Provider::new(theme)],\n            @Text { text: "Hello" }\n        }\n    }.into_widget()\n}\n'})}),"\n",(0,i.jsxs)(n.h4,{id:"using-providers-widget",children:["Using ",(0,i.jsx)(n.code,{children:"Providers"})," Widget"]}),"\n",(0,i.jsxs)(n.p,{children:["Alternatively, you can use the ",(0,i.jsx)(n.code,{children:"Providers"})," widget to wrap a subtree."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:"ignore",children:"use ribir::prelude::*;\n\nstruct UserInfo {\n    name: String,\n}\n\nfn app() -> Widget<'static> {\n    fn_widget! {\n        let user = Stateful::new(UserInfo { name: \"Alice\".to_string() });\n\n        @Providers {\n            providers: [\n                // Share a state writer, allowing descendants to read and modify 'user'\n                // The second argument `None` means we manage dirty notifications manually or don't need layout updates\n                Provider::writer(user, None)\n            ],\n            @Column {\n                @ChildWidget {}\n            }\n        }\n    }.into_widget()\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"consuming-data",children:"Consuming Data"}),"\n",(0,i.jsxs)(n.p,{children:["Descendant widgets can access the provided data using ",(0,i.jsx)(n.code,{children:"Provider::of"})," (read) or ",(0,i.jsx)(n.code,{children:"Provider::write_of"})," (write)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:"ignore",children:'fn child_widget() -> Widget<\'static> {\n    fn_widget! {\n        @Text {\n            // Read from the nearest UserInfo provider\n            text: pipe! {\n                let user = Provider::of::<UserInfo>(BuildCtx::get())?;\n                format!("Hello, {}", user.name)\n            }\n        }\n    }.into_widget()\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"types-of-providers",children:"Types of Providers"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Access"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Provider::new(value)"})}),(0,i.jsx)(n.td,{children:"Share an immutable value."}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Provider::of"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Provider::reader(state)"})}),(0,i.jsx)(n.td,{children:"Share a read-only state."}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"Provider::of"}),", ",(0,i.jsx)(n.code,{children:"Provider::state_of"})," (reader)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Provider::writer(state, phase)"})}),(0,i.jsxs)(n.td,{children:["Share a mutable state. ",(0,i.jsx)(n.code,{children:"phase"})," controls layout dirty marking."]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"Provider::of"}),", ",(0,i.jsx)(n.code,{children:"Provider::write_of"}),", ",(0,i.jsx)(n.code,{children:"Provider::state_of"})," (writer)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Provider::watcher(state)"})}),(0,i.jsx)(n.td,{children:"Share a watcher (observable)."}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"Provider::of"}),", ",(0,i.jsx)(n.code,{children:"Provider::state_of"})," (watcher)"]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"variant-flexible-data-consumption",children:"Variant (Flexible Data Consumption)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Variant"})," is a convenient wrapper around the ",(0,i.jsx)(n.code,{children:"Provider"})," system that automatically handles both static values and dynamic states (watchers). It simplifies consuming provider data by unifying the API for both cases."]}),"\n",(0,i.jsx)(n.h3,{id:"difference-from-direct-provider-access",children:"Difference from Direct Provider Access"}),"\n",(0,i.jsxs)(n.p,{children:["When using ",(0,i.jsx)(n.code,{children:"Provider"})," directly, you need to know whether the data is:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A static value (",(0,i.jsx)(n.code,{children:"Provider::of"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["A state reader/writer (",(0,i.jsx)(n.code,{children:"Provider::state_of"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["A watcher (",(0,i.jsx)(n.code,{children:"Provider::state_of"})," with watcher type)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Variant"})," automatically detects the provider type and handles reactivity for you:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["First checks for a ",(0,i.jsx)(n.strong,{children:"watcher provider"})," (reactive)"]}),"\n",(0,i.jsxs)(n.li,{children:["Falls back to a ",(0,i.jsx)(n.strong,{children:"value provider"})," (static)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"advantages-of-using-variant",children:"Advantages of Using Variant"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Unified API"}),": One method (",(0,i.jsx)(n.code,{children:"Variant::new"}),") works for both static and dynamic providers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Automatic Reactivity"}),": If the provider is a watcher, your widget automatically updates when the value changes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Easy Mapping"}),": Transform values while preserving reactivity using ",(0,i.jsx)(n.code,{children:"map()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Built-in Fallbacks"}),": Use ",(0,i.jsx)(n.code,{children:"new_or()"}),", ",(0,i.jsx)(n.code,{children:"new_or_default()"}),", or ",(0,i.jsx)(n.code,{children:"new_or_else()"})," to provide default values"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:"no_run",children:"use ribir::prelude::*;\n\nfn themed_box() -> Widget<'static> {\n    fn_widget! {\n        // Automatically gets Color from provider (static or reactive)\n        let color = Variant::<Color>::new(BuildCtx::get()).unwrap();\n        \n        @Container {\n            size: Size::new(100., 100.),\n            // If an ancestor provides a writer of Color, this will react to changes\n            background: color,\n        }\n    }.into_widget()\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"using-fallbacks",children:"Using Fallbacks"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:"ignore",children:'fn themed_text() -> Widget<\'static> {\n    fn_widget! {\n        // Use theme color if available, otherwise use red\n        let color = Variant::<Color>::new_or(\n            BuildCtx::get(), \n            Color::from_rgb(255, 0, 0)\n        );\n        \n        @Text {\n            text: "Hello",\n            foreground: color,\n        }\n    }.into_widget()\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"mapping-values",children:"Mapping Values"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:"ignore",children:"fn subtle_background() -> Widget<'static> {\n    fn_widget! {\n        let color = Variant::<Color>::new_or_default(BuildCtx::get());\n        \n        // Transform the color while preserving reactivity\n        let subtle_color = color.map(|c| c.with_alpha(0.1));\n        \n        @Container {\n            background: subtle_color,\n            // ... other properties\n        }\n    }.into_widget()\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"special-color-helpers",children:"Special Color Helpers"}),"\n",(0,i.jsxs)(n.p,{children:["For ",(0,i.jsx)(n.code,{children:"Variant<Color>"}),", there are built-in methods for visiting different tones based on the theme's lightness group:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:"ignore",children:"let primary = Variant::<Color>::new(BuildCtx::get()).unwrap();\n\n// Get different tones based on the theme's lightness group\nlet base = primary.into_base_color(BuildCtx::get());\nlet container = primary.into_container_color(BuildCtx::get());\nlet on_color = primary.on_this_color(BuildCtx::get());\nlet on_container = primary.on_this_container_color(BuildCtx::get());\n"})}),"\n",(0,i.jsxs)(n.p,{children:["These methods automatically adjust the lightness while maintaining reactivity to the source ",(0,i.jsx)(n.code,{children:"Variant"}),", making it easy to create consistent, theme-aware UIs."]}),"\n",(0,i.jsx)(n.h2,{id:"custom-events-messages-up",children:"Custom Events (Messages Up)"}),"\n",(0,i.jsx)(n.p,{children:"Custom events allow a widget to dispatch an event that bubbles up the widget tree. Ancestors can listen to these events without explicitly passing callbacks down."}),"\n",(0,i.jsx)(n.h3,{id:"defining-an-event",children:"Defining an Event"}),"\n",(0,i.jsx)(n.p,{children:"Define a struct to hold your event data."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:"ignore",children:"struct MyCustomEvent {\n    message: String,\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"dispatching-an-event",children:"Dispatching an Event"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"ctx.window().bubble_custom_event(...)"})," to dispatch the event from a widget."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:"ignore",children:'fn child_emitter() -> Widget<\'static> {\n    fn_widget! {\n        @Button {\n            on_tap: move |e| {\n                let event = MyCustomEvent { message: "Clicked!".to_string() };\n                // Bubble the event from this widget (e.id)\n                e.window().bubble_custom_event(e.id, event);\n            },\n            @{ "Emit Event" }\n        }\n    }.into_widget()\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"listening-to-events",children:"Listening to Events"}),"\n",(0,i.jsxs)(n.p,{children:["Ancestors can listen to specific custom events using ",(0,i.jsx)(n.code,{children:"on_custom"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:"ignore",children:'fn parent_listener() -> Widget<\'static> {\n    fn_widget! {\n        @Column {\n            // Listen for MyCustomEvent bubbling up from children\n            on_custom: |e: &mut CustomEvent<MyCustomEvent>| {\n                println!("Received: {}", e.message);\n                \n                // Stop the event from bubbling further up\n                e.stop_propagation();\n            },\n            @child_emitter {}\n        }\n    }.into_widget()\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"listening-to-any-custom-event",children:"Listening to Any Custom Event"}),"\n",(0,i.jsxs)(n.p,{children:["You can also listen to all bubbling custom events using ",(0,i.jsx)(n.code,{children:"on_raw_custom"}),", but you will receive a ",(0,i.jsx)(n.code,{children:"RawCustomEvent"})," that you need to downcast manually if needed."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:"ignore",children:'@Container {\n    on_raw_custom: |e: &mut RawCustomEvent| {\n        println!("Something happened!");\n    }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>a});var i=t(6540);const r={},s=i.createContext(r);function d(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);